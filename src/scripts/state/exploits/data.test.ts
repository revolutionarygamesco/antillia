import { primitives, getPrimitivesExcept } from '../../utilities/testing/primitives.ts'
import ExploitRecord from './class.ts'
import {
  isExploitRecordData,
  isExploitRecordDataArray,
  isExploitRecordDataDictionary
} from './data.ts'

describe('isExploitRecordData', () => {
  it.each([
    ...primitives,
    ['an invalid object', { a: 1 }]
  ] as Array<[string, unknown]>)('rejects %s', (_label, candidate) => {
    expect(isExploitRecordData(candidate)).toBe(false)
  })

  it('accepts exploit record data', () => {
    const record = new ExploitRecord()
    expect(isExploitRecordData(record.toObject())).toBe(true)
  })
})

describe('isExploitRecordDataArray', () => {
  it.each([
    ...getPrimitivesExcept('an array')
  ] as Array<[string, unknown]>)('rejects %s', (_label, candidate) => {
    expect(isExploitRecordDataArray(candidate)).toBe(false)
  })

  it('rejects a single exploit record data object', () => {
    const record = new ExploitRecord()
    expect(isExploitRecordDataArray(record.toObject())).toBe(false)
  })

  it('accepts an empty array', () => {
    expect(isExploitRecordDataArray([])).toBe(true)
  })

  it('accepts an array of exploit record data objects', () => {
    const record = new ExploitRecord()
    expect(isExploitRecordDataArray([record.toObject()])).toBe(true)
  })
})

describe('isExploitRecordDataDictionary', () => {
  it.each([
    ...getPrimitivesExcept('an empty object'),
    ['an invalid object', { a: 1 }]
  ] as Array<[string, unknown]>)('rejects %s', (_label, candidate) => {
    expect(isExploitRecordDataDictionary(candidate)).toBe(false)
  })

  it.each([
    ['an empty object', {}],
    ['a dictionary of ExploitRecordData objects', { abc: { id: 'abc', exploits: [] }}]
  ] as Array<[string, unknown]>)('accepts %s', (_label, candidate) => {
    expect(isExploitRecordDataDictionary(candidate)).toBe(true)
  })
})
