import ExploitRecord from './class.ts'

describe('ExploitRecord', () => {
  describe('constructor', () => {
    it('returns an exploit record', () => {
      expect(new ExploitRecord()).toBeInstanceOf(ExploitRecord)
    })

    it('starts empty', () => {
      const record = new ExploitRecord()
      expect(record.exploits).toHaveLength(0)
    })

    it('can take existing data', () => {
      const data = { id: 'abc', exploits: [['Original 1', 'Mutated 1.1'], ['Original 2']]}
      const record = new ExploitRecord(data)
      expect(record.exploits).toHaveLength(2)
    })
  })

  describe('Instance methods', () => {
    describe('toObject', () => {
      it('returns an object', () => {
        const record = new ExploitRecord()
        const actual = record.toObject()

        expect(actual.id).toBe(record.id)
      })
    })

    describe('serialize', () => {
      it('serializes crew state', () => {
        const record = new ExploitRecord()
        const actual = record.serialize()
        expect(actual).toContain(`{"id":"${record.id}"`)
      })
    })
  })

  describe('Class methods', () => {
    describe('deserialize', () => {
      it('returns null if given an invalid string', () => {
        const actual = ExploitRecord.deserialize('lol nope')
        expect(actual).toBeNull()
      })

      it('deserializes crew state', () => {
        const before = new ExploitRecord()
        const actual = ExploitRecord.deserialize(before.serialize())
        expect(actual).toEqual(before)
      })
    })
  })
})
